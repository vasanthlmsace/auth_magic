{"version":3,"sources":["../src/authmagic.js"],"names":["define","$","Fragment","ModalFactory","ModalEvents","notification","String","AuthMagic","params","self","enrolstatus","displayAuthInfoBox","cancopylink","copyuserLoginlink","loginhook","magicLoginHook","hascourseregister","courseQuickRegistration","prototype","uniqueid","courseid","addHandler","document","querySelectorAll","singleButton","createElement","setAttribute","form","url","courseblock","submit","strquickregister","appendChild","authSelector","strbutton","getMagicLink","potentialiDp","prev","potentialiDpList","getMagicLinks","length","forEach","item","inner","innerHTML","trim","classList","remove","add","userNameBlock","span","passInfo","get_string","when","done","localizedEditString","hide","identityProvider","next","addEventListener","e","preventDefault","returnurl","currentTarget","getAttribute","userEmail","mailSelector","value","magicLogin","email","parentNode","magicForm","invitationlink","items","userlogin","copyText","copyTextCliboard","copyTextBlock","select","copytext","modal","navigator","clipboard","textArea","style","top","left","position","body","focus","execCommand","err","removeChild","writeText","create","title","strconfirm","type","types","CANCEL","getAuthMagicBody","large","then","show","getRoot","on","bodyRendered","copyBoardButton","bind","hidden","destroy","window","open","catch","exception","loadFragment","contextid","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Magic authentication define js.\r\n * @module   auth_magic\r\n * @copyright  2022 bdecent gmbh <https://bdecent.de>\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n define(['jquery', 'core/fragment', 'core/modal_factory', 'core/modal_events', 'core/notification', 'core/str'],\r\n function($, Fragment, ModalFactory, ModalEvents, notification, String) {\r\n\r\n    /**\r\n     * Controls Custom styles tool action.\r\n     * @param {object} params\r\n     */\r\n    var AuthMagic = function(params) {\r\n        var self = this;\r\n        if (params.enrolstatus !== undefined) {\r\n            self.displayAuthInfoBox(params);\r\n        }\r\n        if (params.cancopylink !== undefined) {\r\n            self.copyuserLoginlink(params.cancopylink);\r\n        }\r\n        if (params.loginhook) {\r\n            self.magicLoginHook(params);\r\n        }\r\n        if (params.hascourseregister) {\r\n            self.courseQuickRegistration(params);\r\n        }\r\n        return true;\r\n    };\r\n\r\n    AuthMagic.prototype.courseQuickRegistration = function(params) {\r\n        var uniqueid = \"user-index-participants-\" + params.courseid;\r\n        var handleSelector = \".pagelayout-incourse [data-table-uniqueid=\" + uniqueid + \"]\";\r\n        var addHandler = document.querySelectorAll(handleSelector);\r\n        if (addHandler) {\r\n            var singleButton = document.createElement(\"div\");\r\n            singleButton.setAttribute(\"class\", \"singlebutton quickregister-button\");\r\n\r\n            // Create a form.\r\n            var form = document.createElement(\"form\");\r\n            form.setAttribute(\"method\", \"get\");\r\n            form.setAttribute(\"action\", params.url);\r\n            form.setAttribute(\"id\", \"quickregister-button\");\r\n\r\n            // Create an input element for Full Name\r\n            var courseblock = document.createElement(\"input\");\r\n            courseblock.setAttribute(\"type\", \"hidden\");\r\n            courseblock.setAttribute(\"name\", \"courseid\");\r\n            courseblock.setAttribute(\"value\", params.courseid);\r\n\r\n            var submit = document.createElement(\"input\");\r\n            submit.setAttribute(\"type\", \"submit\");\r\n            submit.setAttribute(\"value\", params.strquickregister);\r\n            submit.setAttribute(\"class\", \"btn btn-secondary my-1\");\r\n\r\n            form.appendChild(courseblock);\r\n            form.appendChild(submit);\r\n            singleButton.appendChild(form);\r\n            addHandler[0].appendChild(singleButton);\r\n        }\r\n    };\r\n\r\n    AuthMagic.prototype.magicLoginHook = function(params) {\r\n        var authSelector = \"#page-login-index .potentialidplist a[title=\\\"\" + params.strbutton + \"\\\"]\";\r\n        if (authSelector) {\r\n            var getMagicLink = document.querySelectorAll(authSelector)[0];\r\n            var potentialiDp = $(\"#page-login-index .potentialidplist\").prev();\r\n            var potentialiDpList = document.querySelectorAll(\"#page-login-index .potentialidplist .potentialidp\");\r\n            if (getMagicLink === undefined) {\r\n                authSelector = \"#page-login-index .login-identityproviders a\";\r\n                var getMagicLinks = document.querySelectorAll(authSelector);\r\n                if (getMagicLinks.length) {\r\n                    getMagicLinks.forEach(function(item) {\r\n                        var inner = item.innerHTML.trim();\r\n                        if (inner == params.strbutton) {\r\n                            getMagicLink = item;\r\n                            potentialiDpList = document.querySelectorAll(\"#page-login-index .login-identityproviders a\");\r\n                            potentialiDp = document.querySelectorAll(\"#page-login-index .login-identityproviders h2\")[0];\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            if (getMagicLink) {\r\n                getMagicLink.classList.remove(\"btn-secondary\");\r\n                getMagicLink.classList.add(\"btn-primary\");\r\n                var userNameBlock = document.querySelectorAll(\"#page-login-index form#login .form-group\")[0];\r\n                if (userNameBlock) {\r\n                    userNameBlock.appendChild(getMagicLink);\r\n                    // Create a span.\r\n                    var span = document.createElement(\"span\");\r\n                    span.setAttribute(\"class\", \"magic-password-instruction\");\r\n                    var passInfo = String.get_string('passinfo', 'auth_magic');\r\n                    $.when(passInfo).done(function(localizedEditString) {\r\n                        span.innerHTML = localizedEditString;\r\n                    });\r\n                    userNameBlock.appendChild(span);\r\n                }\r\n                if (potentialiDpList.length <= 1) {\r\n                    $(potentialiDp).hide();\r\n                        var identityProvider = document.querySelectorAll(\"#page-login-index .login-identityproviders\")[0];\r\n                        if (identityProvider) {\r\n                            $(identityProvider).prev().hide();\r\n                            $(identityProvider).next().hide();\r\n                        }\r\n                }\r\n                getMagicLink.addEventListener(\"click\", function(e) {\r\n                    e.preventDefault();\r\n                    var returnurl = e.currentTarget.getAttribute(\"href\");\r\n                    var userEmail = \"\";\r\n                    var mailSelector = document.querySelectorAll(\"form#login #username\")[0];\r\n                    if (mailSelector) {\r\n                        userEmail = mailSelector.value;\r\n                    }\r\n                    // Create a form.\r\n                    var form = document.createElement(\"form\");\r\n                    form.setAttribute(\"method\", \"post\");\r\n                    form.setAttribute(\"action\", returnurl);\r\n                    form.setAttribute(\"id\", \"magic-login-form\");\r\n\r\n                        // Create an input element for Full Name\r\n                    var magicLogin = document.createElement(\"input\");\r\n                    magicLogin.setAttribute(\"type\", \"hidden\");\r\n                    magicLogin.setAttribute(\"name\", \"magiclogin\");\r\n                    magicLogin.setAttribute(\"value\", 1);\r\n\r\n                    var email = document.createElement(\"input\");\r\n                    email.setAttribute(\"type\", \"hidden\");\r\n                    email.setAttribute(\"name\", \"usermail\");\r\n                    email.setAttribute(\"value\", userEmail);\r\n\r\n                    form.appendChild(magicLogin);\r\n                    form.appendChild(email);\r\n\r\n                    getMagicLink.parentNode.appendChild(form);\r\n\r\n                    var magicForm = document.querySelectorAll(\"form#magic-login-form\")[0];\r\n                    magicForm.submit();\r\n                });\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n\r\n    AuthMagic.prototype.copyuserLoginlink = function(cancopylink) {\r\n        var self = this;\r\n        if (cancopylink) {\r\n            var invitationlink = document.querySelectorAll(\"table.magicinvitationlink .magic-invitationlink\");\r\n            if (invitationlink) {\r\n                invitationlink.forEach(function(items) {\r\n                    items.addEventListener('click', function(e) {\r\n                        e.preventDefault();\r\n                        var userlogin = e.currentTarget.getAttribute(\"data-invitationlink\");\r\n                        self.copyText(userlogin);\r\n                    });\r\n                });\r\n            }\r\n        }\r\n    };\r\n\r\n    AuthMagic.prototype.copyTextCliboard = function() {\r\n        var self = this;\r\n        var copyTextBlock = document.querySelectorAll(\".auth-magic-block #copy-text\")[0];\r\n        if (copyTextBlock) {\r\n            self.copyText(copyTextBlock.value, true);\r\n            copyTextBlock.select();\r\n        }\r\n    };\r\n\r\n    AuthMagic.prototype.copyText = function(copytext, modal = false) {\r\n        if (typeof (navigator.clipboard) == 'undefined') {\r\n            var textArea = document.createElement(\"textarea\");\r\n            textArea.value = copytext;\r\n            // Avoid scrolling to bottom\r\n            textArea.style.top = \"0\";\r\n            textArea.style.left = \"0\";\r\n            textArea.style.position = \"fixed\";\r\n            if (!modal) {\r\n                document.body.appendChild(textArea);\r\n            } else {\r\n                document.querySelectorAll(\".modal .modal-content\")[0].appendChild(textArea);\r\n            }\r\n            textArea.focus();\r\n            textArea.select();\r\n            try {\r\n                document.execCommand('copy');\r\n            } catch (err) {\r\n                return false;\r\n            }\r\n            if (!modal) {\r\n                document.body.removeChild(textArea);\r\n            } else {\r\n                document.querySelectorAll(\".modal .modal-content\")[0].removeChild(textArea);\r\n            }\r\n        } else {\r\n            navigator.clipboard.writeText(copytext);\r\n        }\r\n        return true;\r\n    };\r\n\r\n    AuthMagic.prototype.displayAuthInfoBox = function(params) {\r\n        var self = this;\r\n        ModalFactory.create({\r\n            title: params.strconfirm,\r\n            type: ModalFactory.types.CANCEL,\r\n            body: self.getAuthMagicBody(params),\r\n            large: true\r\n        }).then(function(modal) {\r\n            modal.show();\r\n            modal.getRoot().on(ModalEvents.bodyRendered, function() {\r\n                var copyBoardButton = document.querySelectorAll(\".auth-magic-block .copy-link-block #copy-cliboard\")[0];\r\n                if (copyBoardButton) {\r\n                    copyBoardButton.addEventListener(\"click\", self.copyTextCliboard.bind(self));\r\n                }\r\n            });\r\n            modal.getRoot().on(ModalEvents.hidden, function() {\r\n                modal.destroy();\r\n                window.open(params.returnurl, '_self');\r\n            });\r\n            return modal;\r\n        }).catch(notification.exception);\r\n    };\r\n\r\n    AuthMagic.prototype.getAuthMagicBody = function(params) {\r\n        return Fragment.loadFragment('auth_magic', 'display_box_content', params.contextid, params);\r\n    };\r\n\r\n    return {\r\n        init: function(params) {\r\n            return new AuthMagic(params);\r\n        }\r\n    };\r\n\r\n });"],"file":"authmagic.min.js"}