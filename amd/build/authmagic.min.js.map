{"version":3,"sources":["../src/authmagic.js"],"names":["define","$","Fragment","ModalFactory","ModalEvents","notification","String","AuthMagic","params","self","enrolstatus","displayAuthInfoBox","cancopylink","copyuserLoginlink","loginhook","magicLoginHook","hascourseregister","courseQuickRegistration","prototype","uniqueid","courseid","addHandler","document","querySelectorAll","singleButton","createElement","setAttribute","form","url","courseblock","submit","strquickregister","appendChild","authSelector","strbutton","getMagicLink","potentialiDp","prev","potentialiDpList","getMagicLinks","length","forEach","item","inner","innerHTML","trim","classList","remove","add","userNameBlock","span","passInfo","get_string","when","done","localizedEditString","hide","identityProvider","next","addEventListener","e","preventDefault","returnurl","currentTarget","getAttribute","userEmail","mailSelector","value","magicLogin","email","parentNode","magicForm","invitationlink","items","userlogin","copyText","copyTextCliboard","copyTextBlock","select","copytext","modal","navigator","clipboard","textArea","style","top","left","position","body","focus","execCommand","err","removeChild","writeText","create","title","strconfirm","type","types","CANCEL","getAuthMagicBody","large","then","show","getRoot","on","bodyRendered","copyBoardButton","bind","hidden","destroy","window","open","catch","exception","loadFragment","contextid","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Magic authentication define js.\n * @module   auth_magic\n * @copyright  2022 bdecent gmbh <https://bdecent.de>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n define(['jquery', 'core/fragment', 'core/modal_factory', 'core/modal_events', 'core/notification', 'core/str'],\n function($, Fragment, ModalFactory, ModalEvents, notification, String) {\n\n    /**\n     * Controls Custom styles tool action.\n     * @param {object} params\n     */\n    var AuthMagic = function(params) {\n        var self = this;\n        if (params.enrolstatus !== undefined) {\n            self.displayAuthInfoBox(params);\n        }\n        if (params.cancopylink !== undefined) {\n            self.copyuserLoginlink(params.cancopylink);\n        }\n        if (params.loginhook) {\n            self.magicLoginHook(params);\n        }\n        if (params.hascourseregister) {\n            self.courseQuickRegistration(params);\n        }\n        return true;\n    };\n\n    AuthMagic.prototype.courseQuickRegistration = function(params) {\n        var uniqueid = \"user-index-participants-\" + params.courseid;\n        var handleSelector = \".pagelayout-incourse [data-table-uniqueid=\" + uniqueid + \"]\";\n        var addHandler = document.querySelectorAll(handleSelector);\n        if (addHandler) {\n            var singleButton = document.createElement(\"div\");\n            singleButton.setAttribute(\"class\", \"singlebutton quickregister-button\");\n\n            // Create a form.\n            var form = document.createElement(\"form\");\n            form.setAttribute(\"method\", \"get\");\n            form.setAttribute(\"action\", params.url);\n            form.setAttribute(\"id\", \"quickregister-button\");\n\n            // Create an input element for Full Name\n            var courseblock = document.createElement(\"input\");\n            courseblock.setAttribute(\"type\", \"hidden\");\n            courseblock.setAttribute(\"name\", \"courseid\");\n            courseblock.setAttribute(\"value\", params.courseid);\n\n            var submit = document.createElement(\"input\");\n            submit.setAttribute(\"type\", \"submit\");\n            submit.setAttribute(\"value\", params.strquickregister);\n            submit.setAttribute(\"class\", \"btn btn-secondary my-1\");\n\n            form.appendChild(courseblock);\n            form.appendChild(submit);\n            singleButton.appendChild(form);\n            addHandler[0].appendChild(singleButton);\n        }\n    };\n\n    AuthMagic.prototype.magicLoginHook = function(params) {\n        var authSelector = \"#page-login-index .potentialidplist a[title=\\\"\" + params.strbutton + \"\\\"]\";\n        var getMagicLink = document.querySelectorAll(authSelector)[0];\n        var potentialiDp = $(\"#page-login-index .potentialidplist\").prev();\n        var potentialiDpList = document.querySelectorAll(\"#page-login-index .potentialidplist .potentialidp\");\n        if (getMagicLink === undefined) {\n            authSelector = \"#page-login-index .login-identityproviders a\";\n            var getMagicLinks = document.querySelectorAll(authSelector);\n            if (getMagicLinks.length) {\n                getMagicLinks.forEach(function(item) {\n                    var inner = item.innerHTML.trim();\n                    if (inner == params.strbutton) {\n                        getMagicLink = item;\n                        potentialiDpList = document.querySelectorAll(\"#page-login-index .login-identityproviders a\");\n                        potentialiDp = document.querySelectorAll(\"#page-login-index .login-identityproviders h2\")[0];\n                    }\n                });\n            }\n        }\n        if (getMagicLink) {\n            getMagicLink.classList.remove(\"btn-secondary\");\n            getMagicLink.classList.add(\"btn-primary\");\n            var userNameBlock = document.querySelectorAll(\"#page-login-index form#login .form-group\")[0];\n            if (userNameBlock) {\n                userNameBlock.appendChild(getMagicLink);\n                // Create a span.\n                var span = document.createElement(\"span\");\n                span.setAttribute(\"class\", \"magic-password-instruction\");\n                var passInfo = String.get_string('passinfo', 'auth_magic');\n                $.when(passInfo).done(function(localizedEditString) {\n                    span.innerHTML = localizedEditString;\n                });\n                userNameBlock.appendChild(span);\n            }\n            if (potentialiDpList.length <= 1) {\n                $(potentialiDp).hide();\n                    var identityProvider = document.querySelectorAll(\"#page-login-index .login-identityproviders\")[0];\n                    if (identityProvider) {\n                        $(identityProvider).prev().hide();\n                        $(identityProvider).next().hide();\n                    }\n            }\n            getMagicLink.addEventListener(\"click\", function(e) {\n                e.preventDefault();\n                var returnurl = e.currentTarget.getAttribute(\"href\");\n                var userEmail = \"\";\n                var mailSelector = document.querySelectorAll(\"form#login #username\")[0];\n                if (mailSelector) {\n                    userEmail = mailSelector.value;\n                }\n                // Create a form.\n                var form = document.createElement(\"form\");\n                form.setAttribute(\"method\", \"post\");\n                form.setAttribute(\"action\", returnurl);\n                form.setAttribute(\"id\", \"magic-login-form\");\n\n                    // Create an input element for Full Name\n                var magicLogin = document.createElement(\"input\");\n                magicLogin.setAttribute(\"type\", \"hidden\");\n                magicLogin.setAttribute(\"name\", \"magiclogin\");\n                magicLogin.setAttribute(\"value\", 1);\n\n                var email = document.createElement(\"input\");\n                email.setAttribute(\"type\", \"hidden\");\n                email.setAttribute(\"name\", \"usermail\");\n                email.setAttribute(\"value\", userEmail);\n\n                form.appendChild(magicLogin);\n                form.appendChild(email);\n\n                getMagicLink.parentNode.appendChild(form);\n\n                var magicForm = document.querySelectorAll(\"form#magic-login-form\")[0];\n                magicForm.submit();\n            });\n        }\n    };\n\n    AuthMagic.prototype.copyuserLoginlink = function(cancopylink) {\n        var self = this;\n        if (cancopylink) {\n            var invitationlink = document.querySelectorAll(\"table.magicinvitationlink .magic-invitationlink\");\n            if (invitationlink) {\n                invitationlink.forEach(function(items) {\n                    items.addEventListener('click', function(e) {\n                        e.preventDefault();\n                        var userlogin = e.currentTarget.getAttribute(\"data-invitationlink\");\n                        self.copyText(userlogin);\n                    });\n                });\n            }\n        }\n    };\n\n    AuthMagic.prototype.copyTextCliboard = function() {\n        var self = this;\n        var copyTextBlock = document.querySelectorAll(\".auth-magic-block #copy-text\")[0];\n        if (copyTextBlock) {\n            self.copyText(copyTextBlock.value, true);\n            copyTextBlock.select();\n        }\n    };\n\n    AuthMagic.prototype.copyText = function(copytext, modal = false) {\n        if (typeof (navigator.clipboard) == 'undefined') {\n            var textArea = document.createElement(\"textarea\");\n            textArea.value = copytext;\n            // Avoid scrolling to bottom\n            textArea.style.top = \"0\";\n            textArea.style.left = \"0\";\n            textArea.style.position = \"fixed\";\n            if (!modal) {\n                document.body.appendChild(textArea);\n            } else {\n                document.querySelectorAll(\".modal .modal-content\")[0].appendChild(textArea);\n            }\n            textArea.focus();\n            textArea.select();\n            try {\n                document.execCommand('copy');\n            } catch (err) {\n                return false;\n            }\n            if (!modal) {\n                document.body.removeChild(textArea);\n            } else {\n                document.querySelectorAll(\".modal .modal-content\")[0].removeChild(textArea);\n            }\n        } else {\n            navigator.clipboard.writeText(copytext);\n        }\n        return true;\n    };\n\n    AuthMagic.prototype.displayAuthInfoBox = function(params) {\n        var self = this;\n        ModalFactory.create({\n            title: params.strconfirm,\n            type: ModalFactory.types.CANCEL,\n            body: self.getAuthMagicBody(params),\n            large: true\n        }).then(function(modal) {\n            modal.show();\n            modal.getRoot().on(ModalEvents.bodyRendered, function() {\n                var copyBoardButton = document.querySelectorAll(\".auth-magic-block .copy-link-block #copy-cliboard\")[0];\n                if (copyBoardButton) {\n                    copyBoardButton.addEventListener(\"click\", self.copyTextCliboard.bind(self));\n                }\n            });\n            modal.getRoot().on(ModalEvents.hidden, function() {\n                modal.destroy();\n                window.open(params.returnurl, '_self');\n            });\n            return modal;\n        }).catch(notification.exception);\n    };\n\n    AuthMagic.prototype.getAuthMagicBody = function(params) {\n        return Fragment.loadFragment('auth_magic', 'display_box_content', params.contextid, params);\n    };\n\n    return {\n        init: function(params) {\n            return new AuthMagic(params);\n        }\n    };\n\n });"],"file":"authmagic.min.js"}