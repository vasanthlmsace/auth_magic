define ("auth_magic/authmagic",["jquery","core/fragment","core/modal_factory","core/modal_events","core/notification","core/str"],function(a,b,c,d,e,f){var g=function(a){var b=this;if(a.enrolstatus!==void 0){b.displayAuthInfoBox(a)}if(a.cancopylink!==void 0){b.copyuserLoginlink(a.cancopylink)}if(a.loginhook){b.magicLoginHook(a)}if(a.hascourseregister){b.courseQuickRegistration(a)}};g.prototype.courseQuickRegistration=function(a){var b="user-index-participants-"+a.courseid,c=document.querySelectorAll(".pagelayout-incourse [data-table-uniqueid="+b+"]");if(c){var d=document.createElement("div");d.setAttribute("class","singlebutton quickregister-button");var e=document.createElement("form");e.setAttribute("method","get");e.setAttribute("action",a.url);e.setAttribute("id","quickregister-button");var f=document.createElement("input");f.setAttribute("type","hidden");f.setAttribute("name","courseid");f.setAttribute("value",a.courseid);var g=document.createElement("input");g.setAttribute("type","submit");g.setAttribute("value",a.strquickregister);g.setAttribute("class","btn btn-secondary my-1");e.appendChild(f);e.appendChild(g);d.appendChild(e);c[0].appendChild(d)}};g.prototype.magicLoginHook=function(b){var c="#page-login-index .potentialidplist a[title=\""+b.strbutton+"\"]",d=document.querySelectorAll(c)[0];if(d){d.classList.remove("btn-secondary");d.classList.add("btn-primary");var e=document.querySelectorAll("#page-login-index form#login .form-group")[0];if(e){e.appendChild(d);var g=document.createElement("span");g.setAttribute("class","magic-password-instruction");var h=f.get_string("passinfo","auth_magic");a.when(h).done(function(a){g.innerHTML=a});e.appendChild(g)}var i=a("#page-login-index .potentialidplist").prev(),j=document.querySelectorAll("#page-login-index .potentialidplist .potentialidp");if(1>=j.length){a(i).hide()}d.addEventListener("click",function(a){a.preventDefault();var b=a.currentTarget.getAttribute("href"),c="",e=document.querySelectorAll("form#login #username")[0];if(e){c=e.value}var f=document.createElement("form");f.setAttribute("method","post");f.setAttribute("action",b);f.setAttribute("id","magic-login-form");var g=document.createElement("input");g.setAttribute("type","hidden");g.setAttribute("name","magiclogin");g.setAttribute("value",1);var h=document.createElement("input");h.setAttribute("type","hidden");h.setAttribute("name","usermail");h.setAttribute("value",c);f.appendChild(g);f.appendChild(h);d.parentNode.appendChild(f);var i=document.querySelectorAll("form#magic-login-form")[0];i.submit()})}};g.prototype.copyuserLoginlink=function(a){var b=this;if(a){var c=document.querySelectorAll("table.magicinvitationlink .magic-invitationlink");if(c){c.forEach(function(a){a.addEventListener("click",function(a){a.preventDefault();var c=a.currentTarget.getAttribute("data-invitationlink");b.copyText(c)})})}}};g.prototype.copyTextCliboard=function(){var a=this,b=document.querySelectorAll(".auth-magic-block #copy-text")[0];if(b){a.copyText(b.value,!0);b.select()}};g.prototype.copyText=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1;if("undefined"==typeof navigator.clipboard){var c=document.createElement("textarea");c.value=a;c.style.top="0";c.style.left="0";c.style.position="fixed";if(!b){document.body.appendChild(c)}else{document.querySelectorAll(".modal .modal-content")[0].appendChild(c)}c.focus();c.select();try{document.execCommand("copy")}catch(a){return!1}if(!b){document.body.removeChild(c)}else{document.querySelectorAll(".modal .modal-content")[0].removeChild(c)}}else{navigator.clipboard.writeText(a)}return!0};g.prototype.displayAuthInfoBox=function(a){var b=this;c.create({title:a.strconfirm,type:c.types.CANCEL,body:b.getAuthMagicBody(a),large:!0}).then(function(c){c.show();c.getRoot().on(d.bodyRendered,function(){var a=document.querySelectorAll(".auth-magic-block .copy-link-block #copy-cliboard")[0];if(a){a.addEventListener("click",b.copyTextCliboard.bind(b))}});c.getRoot().on(d.hidden,function(){c.destroy();window.open(a.returnurl,"_self")});return c}).catch(e.exception)};g.prototype.getAuthMagicBody=function(a){return b.loadFragment("auth_magic","display_box_content",a.contextid,a)};return{init:function init(a){return new g(a)}}});
//# sourceMappingURL=authmagic.min.js.map
